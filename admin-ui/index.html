<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å“¡ç™»å…¥ - Pet Care Admin</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- ç™»å…¥å®¹å™¨ -->
    <div class="login-container">
        <div class="login-card">
            <!-- é ­éƒ¨ -->
            <div class="login-header">
                <div class="login-logo">ğŸ¾</div>
                <h1 class="login-title">Pet Care Admin</h1>
                <p class="login-subtitle">ç®¡ç†å“¡ç™»å…¥</p>
            </div>

            <!-- ç™»å…¥è¡¨å–® -->
            <form id="loginForm" class="login-form">
                <!-- éŒ¯èª¤è¨Šæ¯ -->
                <div id="errorMessage" class="form-error"></div>

                <!-- å¸³è™Ÿ -->
                <div class="form-group">
                    <label for="username" class="form-label">å¸³è™Ÿ</label>
                    <input
                        type="text"
                        id="username"
                        name="username"
                        class="form-input"
                        placeholder="è«‹è¼¸å…¥å¸³è™Ÿ"
                        required
                        autocomplete="username"
                    >
                </div>

                <!-- å¯†ç¢¼ -->
                <div class="form-group">
                    <label for="password" class="form-label">å¯†ç¢¼</label>
                    <input
                        type="password"
                        id="password"
                        name="password"
                        class="form-input"
                        placeholder="è«‹è¼¸å…¥å¯†ç¢¼"
                        required
                        autocomplete="current-password"
                    >
                </div>

                <!-- ç™»å…¥æŒ‰éˆ• -->
                <button type="submit" id="loginBtn" class="btn btn-primary btn-block">
                    ç™»å…¥
                </button>
            </form>

            <!-- é å°¾ -->
            <div class="form-footer">
                <p>æ¸¬è©¦å¸³è™Ÿ</p>
                <div class="test-account">
                    <strong>ç®¡ç†å“¡:</strong> admin / admin123
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script>
        /**
         * ç™»å…¥é é¢é‚è¼¯
         */
        document.addEventListener('DOMContentLoaded', () => {
            // å¦‚æœå·²ç™»å…¥,è·³è½‰åˆ°ä¸»é 
            if (Auth.isAuthenticated() && Auth.isAdmin()) {
                window.location.href = 'app.html';
                return;
            }

            // æ¸…é™¤èˆŠçš„èªè­‰è³‡æ–™ (å¯èƒ½æ˜¯éæœŸçš„)
            Auth.clearAuth();

            const loginForm = document.getElementById('loginForm');
            const loginBtn = document.getElementById('loginBtn');
            const errorMessage = document.getElementById('errorMessage');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');

            // è¡¨å–®æäº¤
            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const username = usernameInput.value.trim();
                const password = passwordInput.value;

                // é©—è­‰è¼¸å…¥
                if (!username || !password) {
                    showError('è«‹è¼¸å…¥å¸³è™Ÿå’Œå¯†ç¢¼');
                    return;
                }

                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                setLoading(true);
                hideError();

                try {
                    // å‘¼å«ç™»å…¥ API
                    const result = await Auth.login(username, password);

                    // æª¢æŸ¥æ˜¯å¦ç‚ºç®¡ç†å“¡
                    const user = Auth.getUser();
                    if (user.role !== 'ADMIN') {
                        Auth.clearAuth();
                        showError('æ¬Šé™ä¸è¶³,éœ€è¦ç®¡ç†å“¡æ¬Šé™');
                        setLoading(false);
                        return;
                    }

                    // ç™»å…¥æˆåŠŸ,è·³è½‰åˆ°ä¸»é 
                    window.location.href = 'app.html';
                } catch (error) {
                    console.error('Login error:', error);
                    showError(error.message || 'ç™»å…¥å¤±æ•—,è«‹æª¢æŸ¥å¸³è™Ÿå¯†ç¢¼');
                    setLoading(false);
                }
            });

            // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.classList.add('show');
            }

            // éš±è—éŒ¯èª¤è¨Šæ¯
            function hideError() {
                errorMessage.classList.remove('show');
            }

            // è¨­ç½®è¼‰å…¥ç‹€æ…‹
            function setLoading(loading) {
                if (loading) {
                    loginBtn.disabled = true;
                    loginBtn.innerHTML = '<span class="spinner"></span>';
                } else {
                    loginBtn.disabled = false;
                    loginBtn.textContent = 'ç™»å…¥';
                }
            }

            // Enter éµå¿«é€Ÿç™»å…¥æ¸¬è©¦å¸³è™Ÿ (é–‹ç™¼ç”¨)
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'Enter') {
                    usernameInput.value = 'admin';
                    passwordInput.value = 'admin123';
                    loginForm.dispatchEvent(new Event('submit'));
                }
            });
        });
    </script>
</body>
</html>
